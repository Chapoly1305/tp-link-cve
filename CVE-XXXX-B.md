# CVE-XXXX-B (Awaiting CVE ID)

TP-Link Tapo P125M version 1.0.2 and Kasa KP125M version 1.0.3 do not properly validate certificates, which may allow a remote unauthenticated attacker to eavesdrop on an encrypted communication via a man-in-the-middle attack, and extract account credentials and device configuration, intercept the conversation, as well as unbinding device from existing account.

**Keywords:** Man-in-the-middle, Information Disclosure

## Description
Affected devices utilize MQTT interactive with remote server for status report and user remote control. The affected devices do not validate the certificate of the remote server, attacker may intercept the traffic and perform injection, take control of the affected device, and aquire device status.

The unbind and bind command allows attacker intercept the credentials to login TP-Link web services, expends the affected scope.

## Replication Steps
1. Set up a network with DNS redirection to a PC acting as a proxy.
2. Use tools like [tcpproxy](https://github.com/ickerwx/tcpproxy) for TLS proxying and Wireshark for traffic analysis.
3. Capture and decrypt MQTT traffic between the device and TP-Link servers.
4. Extract MQTT login credentials and device information from the decrypted traffic.
5. Inject malicious MQTT messages to control the device or unbind it from the user account. Await user to bind the device and extract the account credentials.

## Analysis
**CVSS:3.0 8.8 High**

Vector: AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H

- AV: Network. The attacker can exploit this vulnerability in any node between device and TP-Link Cloud service, e.g., ISP, IDC.
- PR: None. Attacker can exploit without having any user or administrator permission of TP-Link product.
- S: Changed. Attackers may inject messages and affect the display information on mobile app. Attacker may use the extracted account credential log on TP-Link website and forms. The attacker may retrieve, alter, or delete information from the account. The attacker may login to other TP-Link products via the mobile companion app, e.g. home camera.
- AC: Low. The attack can be easily replicated and automated. This issue can always be reproduced.
- CIA: High. Information about the device can be revealed and altered. An attacker may cause a device to be inaccessible by sending unpair instruction, the device itself is not damaged. Attackers may eavesdrop TP-Link credentials from newly paired device, or purposely unpair existing device forcing user to pair, causing credentials to be eavesdropped from the traffic. Once the account password is acquired, user personal information can be retrieved, altered, and deleted.

## History
- June 2024: Reported to TP-Link.
- June 2024: Vendor confirmed the issue.
- August 2024: Confirmed mitigated on vendor-provided firmware.